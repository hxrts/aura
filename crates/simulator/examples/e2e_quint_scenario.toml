# E2E Scenario Configuration with Quint Property Verification
# This scenario demonstrates the complete pipeline from Quint specification to simulator execution

[metadata]
name = "dkd_e2e_with_quint"
description = "End-to-end DKD protocol test with Quint formal verification"
author = "Aura Team"
version = "1.0.0"

[setup]
participants = 3
threshold = 2
seed = 42

# Scenario-specific configuration
[scenario_config]
max_ticks = 100
enable_debugging = true
enable_formal_verification = true
quint_spec_path = "../tests/quint_specs/dkd_minimal.qnt"

# Protocol execution phases
[[phases]]
name = "initialization"
description = "Initialize DKD session with threshold participants"

  [[phases.actions]]
  type = "run_choreography"
  choreography_type = "dkd_init"
  participants = ["participant_0", "participant_1", "participant_2"]
  
    [phases.actions.parameters]
    app_id = "test_app"
    context = "e2e_test"
    threshold = 2

  [[phases.actions]]
  type = "wait_ticks"
  ticks = 5

  [[phases.actions]]
  type = "verify_property"
  property = "validCounts"
  expected = true

[[phases]]
name = "protocol_execution"
description = "Execute DKD protocol steps"

  [[phases.actions]]
  type = "run_choreography"
  choreography_type = "dkd_advance"
  participants = ["participant_0", "participant_1"]
  
    [phases.actions.parameters]
    new_state = "commitment"

  [[phases.actions]]
  type = "wait_ticks"
  ticks = 3

  [[phases.actions]]
  type = "verify_property"
  property = "sessionLimit"
  expected = true

  [[phases.actions]]
  type = "run_choreography"
  choreography_type = "dkd_advance"
  participants = ["participant_1", "participant_2"]
  
    [phases.actions.parameters]
    new_state = "complete"

  [[phases.actions]]
  type = "wait_ticks"
  ticks = 2

  [[phases.actions]]
  type = "verify_property"
  property = "safetyProperty"
  expected = true

[[phases]]
name = "validation"
description = "Final validation and property checking"

  [[phases.actions]]
  type = "create_checkpoint"
  label = "final_state"

  [[phases.actions]]
  type = "verify_property"
  property = "progressProperty"
  expected = true

  [[phases.actions]]
  type = "verify_property"
  property = "validCounts"
  expected = true

# Quint properties to monitor during execution
[[properties]]
name = "validCounts"
property_type = "invariant"
description = "Session counts remain consistent"
expression = "validCounts"
check_in_phases = ["initialization", "protocol_execution", "validation"]

[[properties]]
name = "sessionLimit"
property_type = "invariant"
description = "Session count doesn't exceed maximum"
expression = "sessionLimit"
check_in_phases = ["protocol_execution", "validation"]

[[properties]]
name = "safetyProperty"
property_type = "safety"
description = "Basic safety property for completed sessions"
expression = "safetyProperty"
check_in_phases = ["protocol_execution", "validation"]

[[properties]]
name = "progressProperty"
property_type = "liveness"
description = "Protocol makes progress within limits"
expression = "progressProperty"
check_in_phases = ["validation"]

# Expected outcome
expected_outcome = "success"

# Network and Byzantine conditions (optional)
[network]
# Basic network - no partitions for this test

[byzantine]
# No Byzantine behavior for this basic test