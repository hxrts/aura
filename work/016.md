# Work Plan 016 - Layer 4 Safety + Maintainability Fixes

## Goals
- Remove unsafe fallbacks and panics in Layer 4 bridges/facts
- Make guard and consensus orchestration safer and more testable
- Move moderation facts out of `aura-protocol` into a domain crate
- Reduce async blocking and state corruption risks

## Tasks
- [x] 1) Make `TypedHandlerBridge` fail-closed and remove thread-local context (explicit context storage / task-safe access)
- [x] 2) Fix persistent sync index hashing and replace blocking locks in persistent sync handler
- [x] 3) Introduce typed/constant Biscuit metadata access in guard chain
- [x] 4) Make relational consensus orchestration accept injected effects (remove direct `RealRandomHandler`/`PhysicalTimeHandler` usage)
- [x] 5) Move moderation facts/query/reducers from `aura-protocol` into `aura-social`, update imports and registrations
- [x] 6) Replace serialization panics in moderation facts + AMP channel membership fact
